<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} | {{ branding.company_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Dynamic CSS Variables -->
    <style type="text/css">{{ css_variables|safe }}</style>
</head>
<body>
    <header>
        {{ header_html|safe }}
    </header>

    <main>
        <div class="container">
            <section class="settings-header">
                <h2>Settings</h2>
                <p>Customize your reporting tool to match your brand.</p>
            </section>

            <section class="settings-content">
                <div class="settings-card">
                    <h3>Branding Settings</h3>
                    <form id="branding-form" class="settings-form">
                        <div class="form-group">
                            <label for="company-name">Company Name</label>
                            <input type="text" id="company-name" name="company_name" value="{{ branding.company_name }}">
                        </div>
                        
                        <div class="form-group">
                            <label for="logo-url">Logo URL</label>
                            <input type="text" id="logo-url" name="logo_url" value="{{ branding.logo_url or '' }}">
                            <small>Enter a URL to your logo image. Leave blank to use text.</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="primary-color">Primary Color</label>
                            <div class="color-picker">
                                <input type="color" id="primary-color" name="primary_color" value="{{ branding.primary_color }}">
                                <input type="text" id="primary-color-text" value="{{ branding.primary_color }}">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="secondary-color">Secondary Color</label>
                            <div class="color-picker">
                                <input type="color" id="secondary-color" name="secondary_color" value="{{ branding.secondary_color }}">
                                <input type="text" id="secondary-color-text" value="{{ branding.secondary_color }}">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="accent-color">Accent Color</label>
                            <div class="color-picker">
                                <input type="color" id="accent-color" name="accent_color" value="{{ branding.accent_color }}">
                                <input type="text" id="accent-color-text" value="{{ branding.accent_color }}">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="font-family">Font Family</label>
                            <select id="font-family" name="font_family">
                                <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif" {% if branding.font_family == "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif" %}selected{% endif %}>Segoe UI</option>
                                <option value="Arial, sans-serif" {% if branding.font_family == "Arial, sans-serif" %}selected{% endif %}>Arial</option>
                                <option value="'Roboto', sans-serif" {% if branding.font_family == "'Roboto', sans-serif" %}selected{% endif %}>Roboto</option>
                                <option value="'Open Sans', sans-serif" {% if branding.font_family == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                <option value="'Montserrat', sans-serif" {% if branding.font_family == "'Montserrat', sans-serif" %}selected{% endif %}>Montserrat</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="custom-footer">Custom Footer</label>
                            <input type="text" id="custom-footer" name="custom_footer" value="{{ branding.custom_footer }}">
                        </div>
                        
                        <div class="form-group checkbox">
                            <input type="checkbox" id="show-powered-by" name="show_powered_by" {% if branding.show_powered_by %}checked{% endif %}>
                            <label for="show-powered-by">Show "Powered by Marketing Reporting Tool"</label>
                        </div>
                        
                        <div class="form-group">
                            <label for="custom-css">Custom CSS</label>
                            <textarea id="custom-css" name="custom_css" rows="5">{{ branding.custom_css }}</textarea>
                            <small>Add custom CSS to further customize your reporting tool.</small>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn">Save Settings</button>
                            <button type="button" id="reset-defaults" class="btn btn-outline">Reset to Defaults</button>
                        </div>
                    </form>
                </div>
                
                <div class="settings-card">
                    <h3>Preview</h3>
                    <div class="preview-container">
                        <div class="preview-header">
                            <h4 id="preview-company-name">{{ branding.company_name }}</h4>
                        </div>
                        <div class="preview-content">
                            <div class="preview-card">
                                <h5>Sample Card</h5>
                                <p>This is how your branded content will look.</p>
                                <button class="btn preview-btn">Button</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer>
        {{ footer_html|safe }}
    </footer>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const brandingForm = document.getElementById('branding-form');
            const resetDefaultsButton = document.getElementById('reset-defaults');
            
            // Color picker sync
            const colorInputs = document.querySelectorAll('input[type="color"]');
            colorInputs.forEach(input => {
                const textInput = document.getElementById(input.id + '-text');
                
                input.addEventListener('input', () => {
                    textInput.value = input.value;
                    updatePreview();
                });
                
                textInput.addEventListener('input', () => {
                    input.value = textInput.value;
                    updatePreview();
                });
            });
            
            // Update preview on any form change
            brandingForm.addEventListener('input', updatePreview);
            
            // Form submission
            brandingForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(brandingForm);
                const settings = {};
                
                for (const [key, value] of formData.entries()) {
                    if (key === 'show_powered_by') {
                        settings[key] = true;
                    } else {
                        settings[key] = value;
                    }
                }
                
                // Handle unchecked checkbox
                if (!formData.has('show_powered_by')) {
                    settings.show_powered_by = false;
                }
                
                // Send settings to API
                fetch('/api/branding', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Settings saved successfully!');
                        // Reload page to apply new settings
                        window.location.reload();
                    } else {
                        alert('Error saving settings: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error saving settings:', error);
                    alert('Error saving settings. Please try again.');
                });
            });
            
            // Reset to defaults
            resetDefaultsButton.addEventListener('click', function() {
                if (confirm('Are you sure you want to reset all branding settings to defaults?')) {
                    fetch('/api/branding', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            company_name: 'Marketing Reporting Tool',
                            logo_url: '',
                            primary_color: '#4a6cf7',
                            secondary_color: '#6c757d',
                            accent_color: '#28a745',
                            font_family: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
                            show_powered_by: true,
                            custom_css: '',
                            custom_header: '',
                            custom_footer: '&copy; 2025 Marketing Reporting Tool. All rights reserved.'
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Settings reset to defaults!');
                            // Reload page to apply new settings
                            window.location.reload();
                        } else {
                            alert('Error resetting settings: ' + (data.error || 'Unknown error'));
                        }
                    })
                    .catch(error => {
                        console.error('Error resetting settings:', error);
                        alert('Error resetting settings. Please try again.');
                    });
                }
            });
            
            // Update preview function
            function updatePreview() {
                const companyName = document.getElementById('company-name').value;
                const primaryColor = document.getElementById('primary-color').value;
                const secondaryColor = document.getElementById('secondary-color').value;
                const accentColor = document.getElementById('accent-color').value;
                const fontFamily = document.getElementById('font-family').value;
                
                // Update preview elements
                document.getElementById('preview-company-name').textContent = companyName;
                
                // Update preview styles
                const previewContainer = document.querySelector('.preview-container');
                previewContainer.style.fontFamily = fontFamily;
                
                const previewHeader = document.querySelector('.preview-header');
                previewHeader.style.backgroundColor = primaryColor;
                
                const previewCard = document.querySelector('.preview-card');
                previewCard.style.borderColor = secondaryColor;
                
                const previewBtn = document.querySelector('.preview-btn');
                previewBtn.style.backgroundColor = accentColor;
            }
            
            // Initialize preview
            updatePreview();
        });
    </script>
</body>
</html> 